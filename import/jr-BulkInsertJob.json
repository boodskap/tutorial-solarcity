{"type":7,"data":{"domainKey":"EXGQKXOHIN","id":"BulkInsertJob","name":"","jobType":"SCALABLE","jobState":"ENABLED","jobLanguage":"GROOVY","jobCode":"long counter = 0;\n\ntry{\n    \n    def dataQ = grid.stringQueue(\"BULK_DATA_Q\");\n    \n    while(!THIS.isStopped()){\n    \n        def data = dataQ.poll(10, java.util.concurrent.TimeUnit.SECONDS);\n    \n        if(null == data){\n            log.info(\"No more data, stopping...\");\n            return;\n        }\n        \n        //log.info(data);\n        \n        def vals = data.split(\",\");\n        \n        for(int i=0;i<vals.length;i++){\n            vals[i] = vals[i].trim();\n        }\n        \n        def rec = [:];\n        \n        switch(vals[0]){\n            case \"0\": //community\n                //type, id, label, country, state, city, street, zipcode, fname, lname, email, phone, tzone\n                rec.label = vals[2];\n                rec.country = vals[3];\n                rec.state = vals[4];\n                rec.city = vals[5];\n                rec.street = vals[6];\n                rec.zipcode = vals[7];\n                rec.fname = vals[8];\n                rec.lname = vals[9];\n                rec.email = vals[10];\n                rec.phone = vals[11];\n                rec.tzone = vals[12];\n                record.insert(2000, vals[1], rec); //insert into community record\n                break;\n            case \"1\": //household\n                //type, id, community_id, label, doorno, country, state, city, street, zipcode, fname, lname, email, phone, tzone\n                rec.community = vals[2];\n                rec.label = vals[3];\n                rec.doorno = vals[4];\n                rec.country = vals[5];\n                rec.state = vals[6];\n                rec.city = vals[7];\n                rec.street = vals[8];\n                rec.zipcode = vals[9];\n                rec.fname = vals[10];\n                rec.lname = vals[11];\n                rec.email = vals[12];\n                rec.phone = vals[13];\n                rec.tzone = vals[14];\n                record.insert(2001, vals[1], rec); //insert into household record\n                break;\n            case \"2\": //device\n                //type, id, community_id, household_id, label, devicestate, gridloss\n                rec.community = vals[2];\n                rec.household = vals[3];\n                rec.label = vals[4];\n                rec.devicestate = vals[5];\n                rec.gridloss = vals[6];\n                record.insert(2003, vals[1], rec); //insert into device record\n                break;\n            default:\n                log.warn(\"Unknown record type: %s\", vals[0]);\n                break;\n        }\n        \n        if(++counter % 1000 == 0){\n            log.info(\"Inserted %d records\", counter);\n            Thread.sleep(250);\n        }\n    }\n    \n    \n}catch(Exception ex){\n    log.info(util.toString(ex));\n    failure.insert(ex);\n}finally{\n    log.info(\"Total inserted %d records\", counter);\n}\n","instances":1,"startOnBoot":false,"resartOnChange":true}}