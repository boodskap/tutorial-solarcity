{"type":6,"data":{"lang":"GROOVY","code":"import java.io.BufferedReader;\nimport java.io.InputStreamReader;\nimport java.io.ByteArrayInputStream;\n\nlog.info(\"Processing %s\", msg.getProperties());\n\ndef JOB_ID = \"BulkInsertJob\";\ndef MAX_JOBS = 1;\ndef dataQ = grid.stringQueue(\"BULK_DATA_Q\");\n\ndef running = job.countAll(JOB_ID); //check how many jobs running\ndef needed = MAX_JOBS - running; //find if we need more jobs\n\n\nif(needed > 0){\n    job.start(JOB_ID, needed); //start the needed jobs\n}\n\nBufferedReader reader = new BufferedReader(new InputStreamReader(new ByteArrayInputStream(msg.getData())));\nString line = null;\nint counter = 0;\nwhile((line = reader.readLine()) != null){\n    \n    dataQ.offer(line);\n    \n    if(++counter % 5000 == 0){\n        log.info(\"Processed %d lines\", counter);\n        //Thread.sleep(500); //don't burn the system\n    }\n}\n\nlog.info(\"Bulk upload done Total processed %d lines.\", counter);\n","type":"BulkDataUploader"}}